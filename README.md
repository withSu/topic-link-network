# 토픽과 서브토픽 연결 시스템

## 소개 👋

안녕하세요! 이 프로젝트는 토픽(상위개념)과 서브토픽(하위개념) 간의 연결 강도를 자동으로 관리하고 시각화하는 시스템입니다. JSON 형태의 데이터가 입력되면 개념 간의 연결 관계를 자동으로 형성하고, 시간이 지남에 따라 중요도가 낮은 정보는 장기 기억으로 이동시키는 지능적인 메모리 관리 시스템입니다.

![연관 네트워크 예시](./images/visualization.png)

## 이 시스템으로 무엇을 할 수 있나요? 🚀

- ✅ 토픽과 서브토픽 간의 **연결 관계를 자동으로 생성**
- ✅ 서로 다른 토픽 간의 **관련성을 공유 서브토픽 기반으로 계산**
- ✅ 개념 간 연결을 **시각적으로 표현**하여 정보 구조 파악
- ✅ 약한 연결을 가진 개념들을 **자동으로 장기 기억으로 이동**
- ✅ 메모리를 계층(단기/장기)별로 효율적으로 관리

## 시작하기 🏁

### 1. 필요한 패키지를 지원하는 가상환경을 생성하기

```bash
conda env create -f environment.yml
```

또는 아래 명령어로 개별 설치:

```bash
pip install chromadb sentence-transformers networkx matplotlib psutil aiohttp pybloom-live
```

### 2. 대화형 테스트 실행하기

```bash
python interactive_test.py
```

외부 JSON 파일을 사용하려면:

```bash
python interactive_test.py -f your_data.json
```

## 데이터 형식 📊

시스템이 처리하는 JSON 데이터는 다음과 같은 형식을 가집니다:

```json
[
  {
    "user_id": "user1",
    "topic": "basic_info",     // 토픽(상위개념)
    "sub_topic": "name",       // 서브토픽(하위개념)
    "memo": "홍길동"           // 메모 내용
  },
  {
    "user_id": "user1",
    "topic": "work",
    "sub_topic": "project",
    "memo": "AI 개발"
  }
]
```

## 대화형 테스트 메뉴 가이드 🧭

`interactive_test.py`를 실행하면 다음과 같은 메뉴가 표시됩니다:


### 1️⃣ 네트워크 그래프 직접 구축하기

**무엇을 하나요?** JSON 데이터에서 토픽과 서브토픽을 추출하여 연관 네트워크를 처음부터 구축합니다.

**실행하면:**
- 토픽, 서브토픽, 키워드가 그래프의 노드로 추가됩니다
- 토픽-서브토픽 간 계층적 관계(강도 0.9)가 설정됩니다
- 서브토픽 간 의미적 관계(강도 0.7)가 설정됩니다
- 토픽 간 관계는 공유 서브토픽 수에 기반하여 설정됩니다

### 2️⃣ 토픽/서브토픽 관계 설정하기

**무엇을 하나요?** 기존 API를 사용하여 토픽과 서브토픽 간 관계를 설정합니다.

**실행하면:**
- 메모리 매니저를 통해 자동으로 관계가 설정됩니다
- 1번 메뉴와 결과는 유사하지만 내부 처리 방식이 다릅니다

### 3️⃣ 토픽 간 연결 시각화하기

**무엇을 하나요?** 선택한 토픽을 중심으로 다른 토픽들과의 연결을 시각화합니다.

**실행하면:**
- 시작 토픽을 선택할 수 있습니다
- 해당 토픽과 연결된 다른 토픽들이 시각화됩니다
- 토픽은 **빨간색**, 서브토픽은 **파란색**, 키워드는 **녹색**으로 표시됩니다
- 연결 강도는 선의 두께와 색상으로 표현됩니다
- PNG 파일로 저장됩니다

### 4️⃣ 특정 토픽 내부 연결 시각화하기

**무엇을 하나요?** 특정 토픽과 그에 속한 서브토픽들 간의 내부 관계를 시각화합니다.

**실행하면:**
- 토픽을 선택할 수 있습니다
- 해당 토픽과 그에 속한 서브토픽들만 시각화됩니다
- 계층적 관계는 실선으로, 의미적 관계는 점선으로 표시됩니다
- PNG 파일로 저장됩니다

### 5️⃣ 약한 연결 찾기 및 메모리 승격하기

**무엇을 하나요?** 연결 강도가 낮은 개념들을 찾아 장기 기억으로 승격시킵니다.

**실행하면:**
- 연결 강도 임계값을 설정할 수 있습니다 (기본: 0.5)
- 임계값 이하의 약한 연결 목록이 표시됩니다
- 확인 후 관련 메모리를 장기 기억으로 승격시킬 수 있습니다

### 6️⃣ 모든 토픽 연결 통계 보기

**무엇을 하나요?** 토픽별 연결 통계 정보를 표시합니다.

**실행하면:**
- 각 토픽의 총 연결 수가 표시됩니다
- 강한 연결, 중간 연결, 약한 연결로 분류된 통계가 표시됩니다
- 각 카테고리별 몇 가지 예시 연결이 표시됩니다

### 7️⃣ 그래프 내 모든 개념 보기

**무엇을 하나요?** 현재 그래프에 있는 모든 개념(노드)을 나열합니다.

**실행하면:**
- 모든 노드 목록이 번호와 함께 표시됩니다
- 총 개념 수가 표시됩니다

### 8️⃣ JSON 데이터 보기

**무엇을 하나요?** 현재 로드된 JSON 데이터를 확인합니다.

**실행하면:**
- 처음 5개의 JSON 데이터 항목이 표시됩니다
- 총 항목 수가 표시됩니다

## 연결 관계 유형 이해하기 🔄

이 시스템은 다양한 유형의 연결 관계를 사용합니다:

### 계층적 관계 (Hierarchical)

- **어떤 관계인가요?** 상위개념이 하위개념을 포함하는 관계입니다
- **어떻게 표시되나요?** **실선**으로 표시됩니다
- **연결 강도는?** 0.9 (매우 강함)
- **예시:** "basic_info" → "name" (basic_info 토픽은 name 서브토픽을 포함함)

### 의미적 관계 (Semantic)

- **어떤 관계인가요?** 의미적으로 관련된 개념들 간의 관계입니다
- **어떻게 표시되나요?** **점선**으로 표시됩니다
- **연결 강도는?** 
  - 서브토픽 간: 0.7 (중간 강도)
  - 토픽 간: 공유 서브토픽 수에 따라 0.4~0.9
- **예시:** "name" ↔ "age" (같은 basic_info 토픽에 속한 서브토픽들)

### 기타 관계
- **시간적 관계:** 선후 관계를 가진 개념들 (대시-점선으로 표시)
- **감정적 관계:** 감정적 연관이 있는 개념들 (점선으로 표시)

## 연결 강도 계산 방식 💪


### 토픽 → 서브토픽
- **강도:** 0.9 (고정값)
- **의미:** 가장 강한 계층적 관계

### 서브토픽 ↔ 서브토픽
- **강도:** 0.7 (고정값)
- **의미:** 같은 토픽에 속한 서브토픽들 간의 중간 강도 관계

### 토픽 ↔ 토픽
- **계산식:** 0.5 + (공유 서브토픽 수 × 0.1), 최대 0.9
- **의미:** 공유 서브토픽이 많을수록 토픽 간 연관성이 강함
- **최소값:** 공유 서브토픽이 없는 경우 0.4

### 토픽/서브토픽 → 키워드
- **강도:** 
  - 토픽-키워드: 0.5
  - 서브토픽-키워드: 0.6

## 시각화 결과 읽는 법 👁️


### 노드 색상으로 개념 유형 구분하기
- **빨간색 노드:** 토픽 (상위개념)
- **파란색 노드:** 서브토픽 (하위개념)
- **녹색 노드:** 키워드 (메모에서 추출된 중요 단어)

### 선의 스타일로 관계 유형 구분하기
- **실선:** 계층적 관계 (토픽→서브토픽)
- **점선:** 의미적 관계 (서브토픽↔서브토픽)
- **대시-점선:** 기타 관계 (시간적, 감정적 등)

### 선의 두께와 색상으로 연결 강도 이해하기
- **굵고 진한 선:** 강한 연결 (≥0.7)
- **중간 두께 선:** 중간 연결 (0.4~0.7)
- **얇고 연한 선:** 약한 연결 (<0.4)

## 코드 예제 활용하기 💻

### JSON 데이터에서 토픽/서브토픽 관계 설정하기

```python
# JSON 데이터 준비
json_data = [
    {"user_id": "user1", "topic": "basic_info", "sub_topic": "name", "memo": "홍길동"},
    {"user_id": "user1", "topic": "work", "sub_topic": "project", "memo": "AI 개발"}
]

# 토픽/서브토픽 관계 설정
await chatbot.memory_manager.save_topic_subtopic_relations(json_data)
```

### 약한 연결 찾기 및 장기 기억으로 승격하기

```python
# 연결 강도 0.5 이하의 약한 연결 찾기
weak_connections = await chatbot.memory_manager.sqlite.get_weak_connections(0.5)

# 약한 연결 기반 메모리 승격
await chatbot.memory_manager.promote_weak_connections_to_long_term()
```

### 연결 네트워크 시각화하기

```python
# 특정 토픽 중심 시각화
viz_path = f"network_{topic}.png"
await chatbot.visualize_associations(topic, viz_path)
```

## 자주 묻는 질문 ❓

### Q: 토픽과 서브토픽은 어떻게 구분하나요?
**A:** JSON 데이터에서 "topic" 필드는 토픽, "sub_topic" 필드는 서브토픽으로 자동 인식됩니다. 시각화에서는 토픽은 빨간색, 서브토픽은 파란색으로 표시됩니다.

### Q: 연결 강도는 어떻게 조정할 수 있나요?
**A:** 코드 내에서 기본값을 변경하거나, API 호출 시 custom_strength 매개변수를 사용할 수 있습니다.

### Q: 약한 연결의 기준은 무엇인가요?
**A:** 기본적으로 연결 강도가 0.5 이하인 연결을 약한 연결로 간주합니다. 이 임계값은 설정을 통해 조정할 수 있습니다.

### Q: 메모리가 장기 기억으로 승격되는 조건은 무엇인가요?
**A:** 약한 연결을 가진 개념 중 중요도가 0.8 이상이거나 접근 횟수가 3회 이상인 메모리가 장기 기억으로 승격됩니다.

## 향후 개선 방향 🔮

- 메모에서 더 정교한 키워드 추출 알고리즘 적용
- 시간 경과에 따른 연결 강도 자동 조정
- 사용자 피드백 기반 강화학습 도입
- 멀티모달 데이터 지원 (이미지, 음성 등)